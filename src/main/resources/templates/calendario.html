<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Calendario de Eventos</title>
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@3.10.2/dist/fullcalendar.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/moment@2.29.1/min/moment.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/fullcalendar@3.10.2/dist/fullcalendar.min.js"></script>
</head>
<body>
<h1>Calendario de Eventos</h1>
<div id="calendar"></div>

<!-- Modal para Crear Evento -->
<div id="crearEventoModal" style="display: none;">
  <h2>Crear Evento</h2>
  <label for="descripcion">Descripción:</label>
  <input type="text" id="descripcion"><br>
  <label for="direccion">Dirección:</label>
  <input type="text" id="direccion"><br>
  <label for="fechaEvento">Fecha del Evento:</label>
  <input type="date" id="fechaEvento"><br>
  <label for="notificacion">Notificación:</label>
  <input type="text" id="notificacion"><br>
  <button id="guardarEventoBtn">Guardar</button>
  <button onclick="$('#crearEventoModal').hide()">Cancelar</button>
</div>

<script>
  $(document).ready(function() {
      $('#calendar').fullCalendar({
          header: {
              left: 'prev,next today',
              center: 'title',
              right: 'month,agendaWeek,agendaDay'
          },
          defaultDate: moment().format("YYYY-MM-DD"),
          editable: true,
          eventLimit: true,
          events: {
              url: '/api/eventos/listar',  // Conectar con el controlador para obtener eventos
              type: 'GET',
              error: function() {
                  alert('Error al cargar los eventos.');
              }
          },
          selectable: true,
          selectHelper: true,
          select: function(start) {
              $('#fechaEvento').val(moment(start).format("YYYY-MM-DD"));
              $('#crearEventoModal').show();
          }
      });

      $('#guardarEventoBtn').on('click', function() {
          var event = {
              descripcion: $('#descripcion').val(),
              direccion: $('#direccion').val(),
              fechaEvento: $('#fechaEvento').val(),
              notificacion: $('#notificacion').val(),
              idAdmin: 1  // ID del administrador
          };
          $.ajax({
              url: '/api/eventos/crear',
              type: 'POST',
              contentType: 'application/json',
              data: JSON.stringify(event),
              success: function(data) {
                  $('#calendar').fullCalendar('renderEvent', {
                      title: data.descripcion,
                      start: data.fechaEvento,
                      end: data.fechaEvento
                  }, true);
                  $('#crearEventoModal').hide();
              },
              error: function() {
                  alert('Error al guardar el evento.');
              }
          });
      });
  });
</script>
</body>
</html>
